<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Like Charlie — Do Good. Count It. Grow Influence.</title>
<meta name="description" content="Do Good. Count It. Grow Influence, like Charlie. Pick an action, post it, invite 3 friends, and paste your link to complete the challenge.">
<meta property="og:title" content="Do Good. Count It. Grow Influence — Like Charlie">
<meta property="og:description" content="Do one small good action like Charlie, invite 3 friends, and paste your link to complete the challenge.">
<meta property="og:type" content="website">
<meta property="og:url" content="https://cybermave.ai/">
<style>
  :root{--ink:#e6eefc;--bg:#0b1220;--panel:#0f1a33;--muted:#9fb3d1;--brand:#e11d48;--brand2:#2563eb;--border:rgba(255,255,255,.12);--hero-bg:url('/img/patriotism.jpeg')}
  *{box-sizing:border-box} body{margin:0;background:#0b1220;color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  a{color:#9ec5ff;text-decoration:none} .wrap{max-width:1100px;margin:0 auto;padding:20px}
  header{position:sticky;top:0;z-index:60;background:#0c1530cc;backdrop-filter:blur(6px);border-bottom:1px solid var(--border)}
  nav{display:flex;align-items:center;gap:14px;padding:10px 16px} nav a{padding:6px 10px;border-radius:8px} nav a:hover{background:#1a2750}
  .brand{font-weight:800;letter-spacing:.3px}
  .hero{margin:16px;border-radius:18px;overflow:hidden;border:1px solid var(--border);background:linear-gradient(to bottom,rgba(5,12,28,.35),rgba(5,12,28,.70)),var(--hero-bg),linear-gradient(135deg,#0c1b3a 0%,#b91c1c 100%);background-size:cover;background-position:center}
  .hero-inner{padding:46px 18px} .hero h1{margin:0 0 10px 0;font-size:34px}
  .hero-lead{margin:10px 0 0 0;color:#d9e8ff;font-size:18px;max-width:980px;white-space:pre-line}
  .grid{display:grid;gap:16px} .two{grid-template-columns:1fr} @media(min-width:920px){.two{grid-template-columns:1fr 1fr}}
  .card{background:linear-gradient(to bottom,rgba(15,26,51,.92),rgba(15,26,51,.94)),var(--hero-bg),linear-gradient(135deg,#0c1b3a 0%,#142446 100%);background-size:cover;background-position:center;border:1px solid var(--border);border-radius:16px;padding:16px}
  label{display:block;font-weight:600;margin:10px 0 6px} select,input,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid var(--border);background:#0c1630;color:var(--ink)}
  textarea{min-height:110px;resize:vertical} .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  .btn{display:inline-flex;align-items:center;gap:6px;padding:10px 14px;border-radius:10px;border:1px solid var(--border);text-decoration:none;color:#fff;background:#162552;cursor:pointer}
  .btn.brand{background:linear-gradient(90deg,var(--brand),var(--brand2))} .muted{color:var(--muted)} .mini{font-size:.9rem}
  table{width:100%;border-collapse:collapse;margin-top:10px} th,td{border-bottom:1px solid var(--border);padding:8px 6px;text-align:left;color:#d9e8ff}
  footer{margin:24px 0 8px}
  .toast{position:fixed;left:50%;bottom:28px;transform:translateX(-50%);background:#0f1a33;color:#e6eefc;border:1px solid rgba(255,255,255,.12);padding:10px 14px;border-radius:10px;z-index:9999;opacity:0;pointer-events:none;transition:.25s}
  .toast.show{opacity:1;pointer-events:auto}
  .modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.55);display:none;z-index:9998}
  .modal{position:fixed;inset:0;display:none;place-items:center;z-index:9999}
  .modal .panel{max-width:760px;width:92%;background:#0f1a33;border:1px solid rgba(255,255,255,.12);border-radius:16px;padding:16px}
  .modal h3{margin:0 0 8px} .modal .close{float:right;border:1px solid rgba(255,255,255,.12);padding:6px 10px;border-radius:8px;background:#162552;color:#fff;text-decoration:none}
  .modal svg{max-width:100%;border-radius:10px;border:1px solid rgba(255,255,255,.12)}
</style>
</head>
<body>
<header>
  <nav class="wrap">
    <a class="brand" href="/">Like Charlie</a>
    <span style="flex:1"></span>
    <a href="/actions.html">Actions</a>
    <a href="#impact">Impact</a>
    <a href="#resources">Resources</a>
  </nav>
</header>

<main class="wrap">
  <section class="hero">
    <div class="hero-inner">
      <h1>Do Good. Count It. Grow Influence, like Charlie</h1>
      <p class="hero-lead">1. Do one small good action like Charlie - pick from the list in Step one
2. make a quick post about what you did and invite 3 friends to choose to do a good action like Charlie also, 
3. paste your link from your social media post here to complete the challenge. 
"Make doing one small good thing often a pattern, not a one-off."</p>
    </div>
  </section>

  <section class="grid two">
    <!-- STEP 1 -->
    <div id="step1" class="card">
      <h2>Step 1 — Choose & prepare your post</h2>

      <div class="row">
        <div style="flex:1;min-width:260px">
          <label>Choose an action</label>
          <select id="actionSelect"></select>
          <p id="actionDesc" class="muted mini" style="margin-top:6px"></p>
        </div>
        <div>
          <label style="visibility:hidden">.</label>
          <a class="btn" href="/actions.html" title="See explanations and ideas for each action">Explanations of Actions</a>
        </div>
      </div>

      <label style="margin-top:10px">Platform</label>
      <select id="platformSelect">
        <option>Facebook</option><option>X</option><option>Instagram</option>
        <option>TikTok</option><option>LinkedIn</option><option>YouTube</option>
        <option>Truth Social</option><option>Telegram</option><option>Other</option>
      </select>

      <div class="row" style="margin-top:10px">
        <label style="flex:1">Your post (editable)</label>
        <button id="copyPost" class="btn" type="button">Copy Post</button>
      </div>
      <textarea id="copyText" placeholder="Your post appears here…"></textarea>
    </div>

    <!-- STEP 2 -->
    <div id="step2" class="card">
      <h2>Step 2 — Save & Challenge</h2>
      <p class="muted">Post on your platform. Then paste your <b>post’s URL</b> below to complete the challenge.</p>

      <label style="display:flex;align-items:center;gap:10px">
        Paste your post URL
        <a id="helpLink" href="#" class="btn" style="padding:6px 10px">How do I get my Facebook link?</a>
      </label>
      <input id="postUrl" placeholder="https://… (your post link)">
      <small id="urlHint" class="muted mini"></small>

      <details style="margin:6px 0"><summary class="muted">Quick tips</summary>
        <ul class="muted" style="margin:8px 0 0 0;padding-left:18px">
          <li>Open your post → tap/click <b>Share</b> or the <b>timestamp</b> → <b>Copy link</b>.</li>
          <li>If “Copy link” is missing: make the post <b>Public</b> (globe icon), then try again.</li>
        </ul>
      </details>

      <div class="row" style="margin-top:10px">
        <input id="yourName" placeholder="Your name (optional)" style="flex:1;min-width:220px">
        <input id="yourEmail" placeholder="Email (optional)" style="flex:1;min-width:220px">
      </div>

      <!-- Donation attestation -->
      <div class="row" style="margin-top:10px;align-items:center">
        <label class="mini" style="display:flex;gap:8px;align-items:center">
          <input type="checkbox" id="donatedChk"> I donated today
        </label>
      </div>
      <div id="donationFields" style="display:none;margin-top:8px">
        <div class="row">
          <input id="donationOrg" placeholder="Donation organization (e.g., TPUSA)" style="flex:2;min-width:220px">
          <input id="donationAmt" placeholder="Donation amount (e.g., 25.00)" style="flex:1;min-width:160px">
        </div>
        <input id="donationProof" placeholder="Receipt or proof URL (optional)" style="margin-top:8px">
        <p class="mini muted" style="margin:6px 0 0">Note: Claimed donations are <b>unverified</b> until approved and won’t appear publicly until verified.</p>
      </div>

      <div class="row" style="margin-top:12px">
        <button id="saveBtn" class="btn brand">Save & Challenge</button>
      </div>
    </div>
  </section>

  <section id="impact" class="card" style="margin-top:14px">
    <h2>Impact</h2>
    <div class="grid two">
      <div>
        <h3 style="margin-top:0">Leaderboard (by action)</h3>
        <table><thead><tr><th>Action</th><th>Count</th></tr></thead><tbody id="leaderboard"></tbody></table>
      </div>
      <div>
        <h3 style="margin-top:0">Recent</h3>
        <table><thead><tr><th>When</th><th>Action</th><th>Link / Donation</th></tr></thead><tbody id="recent"></tbody></table>
      </div>
    </div>
  </section>

  <section id="resources" class="card" style="margin-top:14px">
    <h2>Resources</h2>
    <ul>
      <li><a href="https://donate.tpusa.com/" target="_blank" rel="noopener">Donate to Turning Point USA</a></li>
      <li><a href="https://tpusa.com/getinvolved/" target="_blank" rel="noopener">Join TPUSA</a></li>
      <li><a href="https://tpusamerch.com/" target="_blank" rel="noopener">Shop TPUSA</a></li>
      <li><a href="https://tpusa.com/events/" target="_blank" rel="noopener">TPUSA Events</a></li>
      <li><a href="https://tpusa.com/" target="_blank" rel="noopener">Turning Point USA</a></li>
      <li><a href="https://charliechallenge.org/" target="_blank" rel="noopener">The Charlie Challenge</a></li>
    </ul>
  </section>

  <!-- Facebook "How to copy link" modal -->
  <div id="fbModalBackdrop" class="modal-backdrop"></div>
  <div id="fbModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="fbHowTitle">
    <div class="panel">
      <a href="#" class="close" id="fbClose">Close</a>
      <h3 id="fbHowTitle">Get your Facebook post link (permalink)</h3>
      <p class="muted mini">Click the <b>timestamp</b> under your name. That opens the post on its own page. Copy the URL.</p>
      <svg viewBox="0 0 880 420" xmlns="http://www.w3.org/2000/svg" style="background:#0c1630">
        <rect x="20" y="20" width="840" height="380" rx="12" fill="#0f1a33" stroke="rgba(255,255,255,.12)"/>
        <circle cx="76" cy="78" r="24" fill="#1d2a55"/>
        <rect x="116" y="60" width="240" height="18" fill="#9fb3d1"/>
        <rect x="116" y="88" width="120" height="14" fill="#6ea8fe"/>
        <rect x="116" y="88" width="120" height="14" fill="none" stroke="#e11d48" stroke-width="2"/>
        <polygon points="246,82 266,82 266,108 246,108" fill="#e11d48"/>
        <text x="276" y="102" fill="#e6eefc" font-family="system-ui,Segoe UI,Roboto" font-size="14">← click the timestamp</text>
        <rect x="40" y="140" width="800" height="200" rx="8" fill="#0b1220" stroke="rgba(255,255,255,.06)"/>
      </svg>
    </div>
  </div>
</main>

<footer class="wrap" style="opacity:.8;font-size:.9rem">
  <p>Not affiliated with charliechallenge.org.</p>
</footer>

<!-- Supabase client (IIFE build) -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.js"></script>

<!-- Your project keys (fill to enable global; leave blank for local fallback) -->
<script>
  window.SUPABASE_URL = "";        // e.g., "https://YOURPROJECTID.supabase.co"
  window.SUPABASE_ANON_KEY = "";   // e.g., "YOUR_PUBLIC_ANON_KEY"
</script>

<!-- Actions + caption logic (loads from /data/actions.json; respects ?action=&desc=&focus=post) -->
<script>
(async function () {
  const data = await fetch('/data/actions.json').then(r=>r.json()).catch(()=>({items:[]}));
  const ALL = data.items || [];

  const selAction   = document.getElementById('actionSelect');
  const selPlatform = document.getElementById('platformSelect');
  const descEl      = document.getElementById('actionDesc');
  const copyBox     = document.getElementById('copyText');
  const copyBtn     = document.getElementById('copyPost');

  selAction.innerHTML = `<option value="">— Select an action —</option>` +
    ALL.map(it=>`<option value="${it.title}" title="${it.desc}">${it.title}</option>`).join('');

  const q = new URLSearchParams(location.search);
  const deepAction   = q.get('action');
  const incomingDesc = q.get('desc');
  const focusTarget  = q.get('focus');

  function tags(p){ const base="#LiveLikeCharlie #OneSmallGoodThing"; return (/instagram|tiktok/i.test(p||"")) ? base+" #Challenge" : base; }
  function writeCaption(desc, act){
    const site = (location.origin || "https://www.cybermave.ai") + "/?action=" + encodeURIComponent(act||"");
    const caption = (desc? (desc+"\n\n") : "") + `I'm doing one small good thing, like Charlie. Join me: pick an action and do one small good thing like Charlie too. ${tags(selPlatform?.value)}\n\nSee how it works: ${site}`;
    if (copyBox) copyBox.value = caption;
  }
  function updateUI(){
    const act = selAction.value;
    const item = ALL.find(x=>x.title===act);
    descEl.textContent = item ? item.desc : "";
    writeCaption(item?item.desc:"", act);
  }

  selAction.addEventListener('change', updateUI);
  selPlatform && selPlatform.addEventListener('change', ()=>writeCaption(descEl.textContent, selAction.value));
  copyBtn?.addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(copyBox.value||''); copyBtn.textContent='Copied!'; setTimeout(()=>copyBtn.textContent='Copy Post',1300);}catch(e){ alert('Copy failed. Select the text and copy manually.'); }});

  if (deepAction && ALL.some(x=>x.title===deepAction)) selAction.value = deepAction;
  if (incomingDesc) { descEl.textContent = incomingDesc; writeCaption(incomingDesc, selAction.value); } else { updateUI(); }
  if (focusTarget==='post'){ setTimeout(()=>{ copyBox?.focus(); copyBox?.scrollIntoView({behavior:'smooth', block:'center'}); }, 60); }
})();
</script>

<!-- Save & Impact (Supabase global if keys present; local fallback otherwise) + Toast + Modal + URL checker + donation gating -->
<script>
(function(){
  const actionEl = document.getElementById('actionSelect');
  const platformEl = document.getElementById('platformSelect');
  const urlEl = document.getElementById('postUrl');
  const nameEl = document.getElementById('yourName');
  const emailEl = document.getElementById('yourEmail');
  const donatedChk = document.getElementById('donatedChk');
  const donationFields = document.getElementById('donationFields');
  const orgEl = document.getElementById('donationOrg');
  const amtEl = document.getElementById('donationAmt');
  const proofEl = document.getElementById('donationProof');
  const saveBtn = document.getElementById('saveBtn');
  const lb = document.getElementById('leaderboard');
  const rc = document.getElementById('recent');
  const helpLink = document.getElementById('helpLink'), modal=document.getElementById('fbModal'), backdrop=document.getElementById('fbModalBackdrop'), closeBtn=document.getElementById('fbClose');
  function openModal(e){ e&&e.preventDefault(); backdrop.style.display='block'; modal.style.display='grid'; }
  function closeModal(e){ e&&e.preventDefault(); backdrop.style.display='none'; modal.style.display='none'; }
  helpLink?.addEventListener('click', openModal); closeBtn?.addEventListener('click', closeModal); backdrop?.addEventListener('click', closeModal); document.addEventListener('keydown',(e)=>{ if(e.key==='Escape') closeModal(); });

  const urlHint = document.getElementById('urlHint');
  function checkURL(){ const v=(urlEl.value||'').trim(); if(!v){ urlHint.textContent=''; return; } const good=/(facebook|fb\.watch|instagram|tiktok|twitter\.com|x\.com|youtube\.com|youtu\.be)/i.test(v); urlHint.textContent=good?'✅ Looks good.':'ℹ️ Paste the link that opens your single post (click its timestamp, then copy the URL).'; }
  urlEl?.addEventListener('input', checkURL); checkURL();

  donatedChk.addEventListener('change', ()=>{ donationFields.style.display = donatedChk.checked ? 'block' : 'none'; });

  function toast(msg){ let t=document.querySelector('.toast'); if(!t){t=document.createElement('div');t.className='toast';document.body.appendChild(t);} t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),2200); }
  function savedToast(){ toast("LiveLikeCharlie says: Saved! Now text this page to 3 friends and ask them to do one small good thing today."); }

  const hasSupa = !!(window.SUPABASE_URL && window.SUPABASE_ANON_KEY && window.supabase);
  const supa = hasSupa ? window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY) : null;

  function loadLocal(){ try { return JSON.parse(localStorage.getItem('lc_log')||'[]'); } catch{ return [] } }
  function saveLocal(rows){ localStorage.setItem('lc_log', JSON.stringify(rows)); }

  async function renderImpact(){
    if (hasSupa){
      const { data: recent } = await supa.from('public_submissions').select('created_at, action, url, donation_org, donation_amt').eq('approved',true).order('created_at',{ascending:false}).limit(10);
      const { data: counts } = await supa.rpc('public_action_counts');
      rc.innerHTML = (recent||[]).map(r=>{ const when=new Date(r.created_at).toLocaleString(); const link=r.url?`<a href="${r.url}" target="_blank" rel="noopener">open</a>`:''; const donation=(r.donation_org||r.donation_amt)?` • ${r.donation_org||''} ${r.donation_amt?('$'+r.donation_amt):''}`:''; return `<tr><td>${when}</td><td>${r.action||''}</td><td>${link}${donation}</td></tr>`;}).join('')||`<tr><td colspan="3" class="muted">No entries yet.</td></tr>`;
      lb.innerHTML = (counts||[]).map(r=>`<tr><td>${r.action}</td><td>${r.cnt}</td></tr>`).join('')||`<tr><td colspan="2" class="muted">No data yet.</td></tr>`;
      return;
    }
    const rows = loadLocal().slice().reverse();
    rc.innerHTML = rows.slice(0,10).map(r=>{ const when=new Date(r.ts).toLocaleString(); const link=r.url?`<a href="${r.url}" target="_blank" rel="noopener">open</a>`:''; const donation=(r.donation_org||r.donation_amt)?` • ${r.donation_org||''} ${r.donation_amt?('$'+r.donation_amt):''}`:''; return `<tr><td>${when}</td><td>${r.action||''}</td><td>${link}${donation}</td></tr>`;}).join('')||`<tr><td colspan="3" class="muted">No entries yet.</td></tr>`;
    const counts={}; rows.forEach(r=>{ if(r.action) counts[r.action]=(counts[r.action]||0)+1; }); const list=Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,10);
    lb.innerHTML = list.map(([a,c])=>`<tr><td>${a}</td><td>${c}</td></tr>`).join('')||`<tr><td colspan="2" class="muted">No data yet.</td></tr>`;
  }

  saveBtn?.addEventListener('click', async ()=>{
    const row = {
      ts_ms: Date.now(),
      action: actionEl?.value||'',
      platform: platformEl?.value||'',
      url: urlEl?.value||'',
      name: nameEl?.value||'',
      email: emailEl?.value||'',
      donated: donatedChk.checked || false,
      donation_org: orgEl?.value||'',
      donation_amt: amtEl?.value||'',
      donation_evidence_url: proofEl?.value||'',
      attested: donatedChk.checked || false
    };
    if (!row.action){ toast('Choose an action first.'); return; }

    if (hasSupa){
      const { error } = await supa.from('public_submissions').insert(row);
      if (error){ console.warn(error); toast('Online save failed; kept a local copy.'); }
      else { urlEl.value=''; orgEl.value=''; amtEl.value=''; proofEl.value=''; donatedChk.checked=false; donationFields.style.display='none'; }
    }
    const now = loadLocal(); now.push({ ...row, ts: row.ts_ms }); saveLocal(now);
    await renderImpact();
    savedToast();
  });

  if(location.hash==='#step1'){ document.getElementById('step1')?.scrollIntoView({behavior:'smooth'}); }
  renderImpact();
})();
</script>
</body>
</html>
