<!doctype html>
<html lang="en" data-theme="patriotic">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Like Charlie — Do Good. Count It. Grow Influence.</title>
<meta name="description" content="Do one small good thing, post it, invite 3 friends, paste your link so it counts.">
<style>
  :root{ --ink:#e6eefc; --bg:#0b1220; --panel:#0f1a33; --muted:#9fb3d1; --brand:#e11d48; --brand2:#2563eb; --border:rgba(255,255,255,.14); }
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  a{color:#b3d4ff;text-decoration:none} .wrap{max-width:1100px;margin:0 auto;padding:20px}
  header{position:sticky;top:0;z-index:60;background:linear-gradient(180deg,rgba(0,0,0,.45),rgba(0,0,0,.15));backdrop-filter:blur(8px);border-bottom:1px solid var(--border)}
  nav{display:flex;align-items:center;gap:10px;padding:10px 16px} nav a{padding:8px 12px;border-radius:10px} nav a:hover{background:rgba(255,255,255,.06)}
  .card{background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:18px;margin-top:16px}
  label{display:block;font-weight:700;margin:10px 0 6px} select,input,textarea{width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);background:rgba(255,255,255,.04);color:var(--ink)}
  textarea{min-height:120px;resize:vertical} .row{display:flex;flex-wrap:wrap;gap:10px;align-items:center}
  .btn{display:inline-flex;align-items:center;gap:8px;padding:11px 16px;border-radius:12px;border:1px solid var(--border);text-decoration:none;color:#fff;background:linear-gradient(90deg,var(--brand),var(--brand2));cursor:pointer}
  .muted{color:var(--muted)} .mini{font-size:.9rem}
  table{width:100%;border-collapse:collapse;margin-top:12px} th,td{border-bottom:1px solid var(--border);padding:10px 8px;text-align:left;color:#e6f0ff}
  .toast{position:fixed;left:50%;bottom:28px;transform:translateX(-50%);background:#0f1a33;color:#e6eefc;border:1px solid var(--border);padding:10px 14px;border-radius:12px;z-index:9999;opacity:0;pointer-events:none;transition:.25s}
  .toast.show{opacity:1;pointer-events:auto}
</style>
</head>
<body>
<header>
  <nav class="wrap">
    <a href="/" class="brand">Like Charlie</a>
    <span style="flex:1"></span>
    <a href="/actions.html">Actions</a>
  </nav>
</header>

<main class="wrap">
  <div class="card">
    <h1 style="margin:0 0 8px">Do Good. Count It. Grow Influence</h1>
    <p class="muted">Step 1: choose an action & write your post. Step 2: paste your social link & save.</p>
  </div>

  <div id="step1" class="card">
    <h2>Step 1 — Choose & prepare your post</h2>
    <label>Choose an action</label>
    <select id="actionSelect">
      <option value="">— Select —</option>
      <option>Raise the Flag</option>
      <option>Publicly Thank Someone</option>
      <option>Pick Up 10 Pieces</option>
      <option>Pray for Someone</option>
      <option>Read the Bible for 15</option>
      <option>Help at Home</option>
      <option>Be a Friend</option>
    </select>

    <label style="margin-top:10px">Your post (editable)</label>
    <textarea id="copyText" placeholder="Your post appears here…"></textarea>
    <div class="row"><button id="copyPost" class="btn" type="button">Copy Post</button></div>
  </div>

  <div id="step2" class="card">
    <h2>Step 2 — Save & Challenge</h2>
    <label>Paste your post URL</label>
    <input id="postUrl" placeholder="https://… (your post link)">
    <div class="row" style="margin-top:12px">
      <button id="saveBtn" class="btn">Save & Challenge</button>
    </div>
    <p class="mini muted" style="margin-top:8px">Tip: On Facebook, click the <b>timestamp</b> on your post → copy the link → paste above.</p>
  </div>

  <div id="impact" class="card">
    <h2>Impact</h2>
    <div class="row" style="gap:16px;flex-wrap:wrap">
      <div style="flex:1;min-width:280px">
        <h3 style="margin:0 0 6px">Leaderboard</h3>
        <table><thead><tr><th>Action</th><th>Count</th></tr></thead><tbody id="leaderboard"></tbody></table>
      </div>
      <div style="flex:1;min-width:280px">
        <h3 style="margin:0 0 6px">Recent</h3>
        <table><thead><tr><th>When</th><th>Action</th><th>Link</th></tr></thead><tbody id="recent"></tbody></table>
      </div>
    </div>
  </div>
</main>

<footer class="wrap" style="opacity:.85;margin-top:24px">
  <p><a href="/about.html">About</a> • <a href="/privacy.html">Privacy</a> • <a href="/terms.html">Terms</a> • <a href="/actions.html">Actions</a></p>
  <p class="muted">Not affiliated with charliechallenge.org.</p>
</footer>

<div class="toast" id="toast"></div>

<!-- Supabase client -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.js"></script>

<!-- YOUR Supabase project (GLOBAL Impact ON) -->
<script>
  // URL stays the same; publishable key from your screenshot:
  const SUPA_URL = "https://tiajlbxezlddhxtebtbg.supabase.co";
  const SUPA_KEY = "sb_publishable_7BO_7z8Z3yTdmxfBL457qg_qnfCMv34";
  const db = window.supabase.createClient(SUPA_URL, SUPA_KEY);
</script>

<script>
(function(){
  const $ = id => document.getElementById(id);
  const actionEl = $('actionSelect'), postEl = $('copyText'), urlEl = $('postUrl');
  const lbT = $('leaderboard'), rcT = $('recent'), toast = $('toast');

  // Simple caption
  function buildCaption(){
    const act = actionEl.value || 'One Small Good Thing';
    return `I'm doing one small good thing, like Charlie: ${act}.
Join me: pick an action and do one small good thing like Charlie too. #LiveLikeCharlie #OneSmallGoodThing`;
  }
  actionEl.addEventListener('change', ()=>{ postEl.value = buildCaption(); });
  postEl.value = buildCaption();
  $('copyPost').addEventListener('click', async ()=>{ try{ await navigator.clipboard.writeText(postEl.value); msg('Post copied'); }catch(e){ msg('Copy failed'); } });

  function msg(t){ toast.textContent=t; toast.classList.add('show'); setTimeout(()=>toast.classList.remove('show'), 1800); }

  // GLOBAL: render Impact
  async function renderImpact(){
    // recent
    const { data: recent } = await db.from('public_submissions')
      .select('created_at, action, url').eq('approved', true)
      .order('created_at',{ascending:false}).limit(200);
    rcT.innerHTML = (recent||[]).slice(0,10).map(r=>{
      const when = new Date(r.created_at).toLocaleString();
      const link = r.url ? `<a href="${r.url}" target="_blank" rel="noopener">open</a>` : '';
      return `<tr><td>${when}</td><td>${r.action||''}</td><td>${link}</td></tr>`;
    }).join('') || `<tr><td colspan="3" class="muted">No entries yet.</td></tr>`;

    // leaderboard (compute in JS)
    const counts = {};
    (recent||[]).forEach(r=>{ if(r.action) counts[r.action]=(counts[r.action]||0)+1; });
    const rows = Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,10);
    lbT.innerHTML = rows.length ? rows.map(([a,c])=>`<tr><td>${a}</td><td>${c}</td></tr>`).join('')
                                : `<tr><td colspan="2" class="muted">No data yet.</td></tr>`;
  }

  // GLOBAL: save
  $('saveBtn').addEventListener('click', async ()=>{
    const action = actionEl.value.trim();
    const url = urlEl.value.trim();
    if(!action){ msg('Choose an action'); return; }
    const row = { ts_ms: Date.now(), action, platform:'web', url, name:'', email:'', donated:false, donation_org:'', donation_amt:'', donation_evidence_url:'', attested:false };
    const { error } = await db.from('public_submissions').insert(row);
    if(error){ console.warn(error); msg('Save failed'); return; }
    urlEl.value=''; msg('Saved!');
    renderImpact();
  });

  renderImpact();
})();
</script>
  <!-- ========== DIAGNOSTICS (temporary) ========== -->
<style>
  #diag{position:fixed;right:12px;bottom:12px;background:#0f1a33;color:#e6eefc;
    border:1px solid rgba(255,255,255,.2);border-radius:10px;padding:10px 12px;
    font:12px/1.35 system-ui,Segoe UI,Roboto,Arial;z-index:9999;max-width:320px}
  #diag b{color:#9fe29f} #diag .bad{color:#ffb4b4}
  #diag button{margin-top:6px;border:1px solid rgba(255,255,255,.2);background:#162552;
    color:#fff;border-radius:8px;padding:6px 10px;cursor:pointer}
</style>
<div id="diag">
  <div>Supabase status: <span id="d-status">checking…</span></div>
  <div id="d-msg" style="margin-top:6px;color:#9fb3d1"></div>
  <button id="d-run">Run test</button>
</div>
<script>
(function(){
  const $=id=>document.getElementById(id);
  const db = (window.supabase && window.SUPABASE_URL && window.SUPABASE_ANON_KEY)
    ? window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY) : null;

  async function check(){
    if(!db){ $('d-status').innerHTML='<span class="bad">no client/keys</span>'; $('d-msg').textContent='Check you pasted sb_publishable… key & the script tag.'; return; }
    $('d-status').textContent='connecting…';
    try{
      // quick read (ok if empty)
      const { data:recent, error:rErr } = await db.from('public_submissions')
        .select('id').eq('approved', true).limit(1);
      if(rErr) throw rErr;
      $('d-status').innerHTML='<b>connected ✓</b>';
      $('d-msg').textContent='Read OK. Click "Run test" to try a write.';
    }catch(e){
      $('d-status').innerHTML='<span class="bad">read error</span>';
      $('d-msg').textContent=(e && e.message) ? e.message : String(e);
    }
  }

  async function runWrite(){
    if(!db) return;
    $('d-status').textContent='writing…';
    try{
      const { error:wErr } = await db.from('public_submissions').insert({
        ts_ms: Date.now(), action:'DIAG write test', platform:'web', url:'',
        name:'', email:'', donated:false, donation_org:'', donation_amt:'',
        donation_evidence_url:'', attested:false
      });
      if(wErr) throw wErr;
      $('d-status').innerHTML='<b>write OK ✓</b>';
      $('d-msg').textContent='A DIAG row was inserted. You can delete it later.';
    }catch(e){
      $('d-status').innerHTML='<span class="bad">write error</span>';
      $('d-msg').textContent=(e && e.message) ? e.message : String(e);
    }
  }

 <script>
(function(){
  const $=id=>document.getElementById(id);
  const db = window.supabase.createClient(window.SUPABASE_URL, window.SUPABASE_ANON_KEY);
  const actionEl=$('actionSelect'), urlEl=$('postUrl'), saveBtn=$('saveBtn');
  const recentT=$('recent'), lbT=$('leaderboard');

  function toast(msg){
    let t=document.querySelector('.toast'); if(!t){t=document.createElement('div');t.className='toast';document.body.appendChild(t);}
    t.textContent=msg; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),1800);
  }

  async function renderImpact(){
    const { data: recent, error: rErr } = await db.from('public_submissions')
      .select('created_at, action, url').eq('approved', true)
      .order('created_at',{ascending:false}).limit(200);
    if(rErr){ toast('Read error: '+rErr.message); return; }

    // recent
    recentT.innerHTML = (recent||[]).slice(0,10).map(r=>{
      const when=new Date(r.created_at).toLocaleString();
      const link=r.url?`<a href="${r.url}" target="_blank" rel="noopener">open</a>`:'';
      return `<tr><td>${when}</td><td>${r.action||''}</td><td>${link}</td></tr>`;
    }).join('') || `<tr><td colspan="3" class="muted">No entries yet.</td></tr>`;

    // leaderboard
    const counts={}; (recent||[]).forEach(r=>{ if(r.action) counts[r.action]=(counts[r.action]||0)+1; });
    const rows=Object.entries(counts).sort((a,b)=>b[1]-a[1]).slice(0,10);
    lbT.innerHTML = rows.length ? rows.map(([a,c])=>`<tr><td>${a}</td><td>${c}</td></tr>`).join('')
                                : `<tr><td colspan="2" class="muted">No data yet.</td></tr>`;
  }

  saveBtn.addEventListener('click', async ()=>{
    const action = (actionEl.value||'').trim();
    const url = (urlEl.value||'').trim();
    if(!action){ toast('Choose an action first'); return; }

    const { error } = await db.from('public_submissions').insert({
      ts_ms: Date.now(), action, platform:'web', url,
      name:'', email:'', donated:false, donation_org:'', donation_amt:'',
      donation_evidence_url:'', attested:false
    });

    if(error){
      toast('Save error: '+error.message);
      console.warn('Supabase insert failed:', error);
      return;
    }
    urlEl.value=''; toast('Saved!');
    renderImpact();
  });

  renderImpact();
})();
</script>

  check();
})();
</script>
<!-- ========== /DIAGNOSTICS ========== -->
</body>
</html>
