<!doctype html>
<html lang="en">
  <header>
  <div class="nav wrap" style="display:flex;align-items:center;justify-content:space-between;gap:16px;padding:12px 0">
    <div class="brand" style="font-weight:900">üá∫üá∏ <span style="color:var(--brand)">Live</span>Like<span style="color:var(--accent)">Charlie</span>.org</div>
    <nav style="display:flex;gap:12px;align-items:center">
      <a href="/actions.html">Actions</a>
      <a href="/about.html">About</a>
      <a href="/privacy.html">Privacy</a>
      <a href="/proofs.html">Proofs</a>
      <a href="/admin.html">Admin</a>
      <a href="/#impact" class="button" data-impact>Impact</a>
    </nav>
  </div>
</header>

</head>

<!-- THEME (put in <head> on every page) -->
<style>
  :root{
    --ink:#eaf2ff; --muted:#9fb3d1;
    --brand:#e11d48; --accent:#2563eb;
    --panel-bg: rgba(10,18,39,.58);
    --panel-border: rgba(255,255,255,.16);
    --glow: 0 10px 30px rgba(0,0,0,.45);
  }
  body.has-photo{color:var(--ink); background:#0b1220; margin:0}
  #page-bg{position:fixed; inset:0; z-index:-2; background:#0b1220 center/cover no-repeat; transition:opacity .6s ease}
  #page-bg::after{content:""; position:absolute; inset:0; background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.70) 55%,rgba(0,0,0,.9));}
  .panel,.card{background:var(--panel-bg)!important;border:1px solid var(--panel-border)!important;border-radius:16px;box-shadow:var(--glow);}
  header{backdrop-filter:blur(8px); border-bottom:1px solid var(--panel-border)}
  .break{height:10px;border-radius:999px;margin:18px 0;background:repeating-linear-gradient(45deg,var(--brand) 0 10px,#fff 10px 20px,var(--accent) 20px 30px);opacity:.9}
  a{color:#b3d4ff;text-decoration:none}
  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:1px solid var(--panel-border);padding:10px;text-align:left}
  input,select,textarea,button{background:#0c1731;color:#fff;border:1px solid var(--panel-border);border-radius:12px;padding:10px 12px}
  button{background:linear-gradient(180deg,var(--accent),#1e49b8);border:none;font-weight:800;cursor:pointer}
</style>

  
<meta property="og:title" content="Live Like Charlie ‚Äî Do one small good action."/>
<meta property="og:description" content="Pick an action, post it, paste your link so it counts, and invite 3 friends."/>
<meta property="og:image" content="https://livelikecharliechallenge.org/og.jpg"/>
<meta name="twitter:card" content="summary_large_image"/>

<style>
  header nav a{padding:8px 12px;border-radius:10px;text-decoration:none;border:1px solid transparent}
  header nav a:hover{background:rgba(255,255,255,.06)}
  header nav a.active{border-color:rgba(255,255,255,.18);background:rgba(255,255,255,.08)}
  header nav .button{background:var(--accent);color:#fff;border:none}
</style>

<script>
(function(){
  const impact = document.querySelector('a[data-impact]');
  if (impact){
    impact.addEventListener('click', (e)=>{
      // if already on home, smooth-scroll; else go to /#impact
      const onHome = location.pathname === '/' || location.pathname.endsWith('/index.html');
      if (onHome){
        e.preventDefault();
        document.getElementById('impact')?.scrollIntoView({behavior:'smooth'});
      }
    });
  }
  // Active link highlighting for the current page
  const path = location.pathname.replace(/\/index\.html$/, '/');
  document.querySelectorAll('header nav a[href]').forEach(a=>{
    const href = a.getAttribute('href');
    if (!href) return;
    if (href === '/#impact') return; // anchor button handled separately
    if (path.startsWith(href)) a.classList.add('active');
  });
})();
</script>
<head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Like Charlie ‚Äî Admin</title>
<style>
  body{margin:0;background:#0b1220;color:#e6eefc;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif}
  .wrap{max-width:1200px;margin:0 auto;padding:20px}
  h1{margin:0 0 12px}
  .row{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px}
  table{width:100%;border-collapse:collapse}
  th,td{border-bottom:1px solid rgba(255,255,255,.12);padding:8px 6px;text-align:left}
  input,select{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,.12);background:#0c1630;color:#e6eefc}
  .btn{padding:8px 12px;border:1px solid rgba(255,255,255,.12);border-radius:8px;background:#162552;color:#fff;text-decoration:none;display:inline-block}
  .badge{padding:2px 8px;border-radius:999px;border:1px solid rgba(255,255,255,.12)}
  .ok{background:#134e4a}.no{background:#5b1d2a}.warn{background:#5a3b12}
  .mini{font-size:.9rem;color:#9fb3d1}
</style>
</head>
<body>

<!-- BACKGROUND (put right after <body> on every page) -->
<div id="page-bg" aria-hidden="true"></div>
<script>
  document.body.classList.add('has-photo');
  const bgImages=[
    "https://images.unsplash.com/photo-1465447142348-e9952c393450?q=80&w=2000&auto=format&fit=crop",
    "https://images.unsplash.com/photo-1509099836639-18ba1795216d?q=80&w=2000&auto=format&fit=crop",
    "https://images.unsplash.com/photo-1511735643442-503bb3bd3487?q=80&w=2000&auto=format&fit=crop",
    "https://images.unsplash.com/photo-1519681393784-d120267933ba?q=80&w=2000&auto=format&fit=crop"
  ];
  const bg=document.getElementById('page-bg'); let i=0;
  function setBG(idx){ bg.style.opacity=0; setTimeout(()=>{ bg.style.backgroundImage=`url("${bgImages[idx]}")`; bg.style.opacity=1; },220); }
  setBG(i); setInterval(()=>{ i=(i+1)%bgImages.length; setBG(i); },12000);
</script>

  
<main class="wrap">
  <h1>Admin ‚Äî Submissions</h1>
  <div class="row">
    <input id="filterText" placeholder="Search action/org/name/email‚Ä¶">
    <select id="filterApproved"><option value="all">All</option><option value="true">Approved</option><option value="false">Unapproved</option></select>
    <select id="filterDonation"><option value="all">All donations</option><option value="unverified">Unverified</option><option value="verified">Verified</option><option value="rejected">Rejected</option><option value="none">No donation claimed</option></select>
    <a class="btn" href="/" target="_self">‚Üê Back to site</a>
  </div>
  <div id="totals" class="mini"></div>
  <table>
    <thead><tr>
      <th>When</th><th>Action</th><th>URL</th><th>Donation</th><th>Status</th><th>Approved</th><th>Name/Email</th><th>Actions</th>
    </tr></thead>
    <tbody id="rows"></tbody>
  </table>
</main>
<script>
  window.SUPABASE_URL = "https://tiajlbxezlddhxtebtbg.supabase.co";
  window.SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InRpYWpsYnhlemxkZGh4dGVidGJnIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA0NTcwNTYsImV4cCI6MjA3NjAzMzA1Nn0.szBJhvyDcV6oDn-NgVUUxF_MZdHC60xXBe0AgDDQbbU";
</script>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/supabase.js"></script>
<script>
(async function(){
  const URL = window.SUPABASE_URL || "";       // reuses globals from index if served same origin
  const KEY = window.SUPABASE_ANON_KEY || "";
  if(!URL || !KEY){ alert('Missing SUPABASE_URL / SUPABASE_ANON_KEY in window. Add the same two <script> lines here or serve from the same page scope.'); return; }
  const db = window.supabase.createClient(URL, KEY);

  const rowsEl=document.getElementById('rows'), totalsEl=document.getElementById('totals');
  const fTxt=document.getElementById('filterText'), fApp=document.getElementById('filterApproved'), fDon=document.getElementById('filterDonation');

  async function load(){
    let q = db.from('public_submissions').select('*').order('created_at',{ascending:false}).limit(1000);
    if (fApp.value==='true')  q=q.eq('approved', true);
    if (fApp.value==='false') q=q.eq('approved', false);
    const { data } = await q;
    const text=(fTxt.value||'').toLowerCase();
    const filt = (data||[]).filter(r=>{
      const matchesText = !text || [r.action,r.name,r.email,r.donation_org,(r.url||'')].some(v=>(v||'').toLowerCase().includes(text));
      const matchesDon =
        fDon.value==='all' ? true :
        fDon.value==='none' ? !r.donated :
        (r.donation_status===fDon.value);
      return matchesText && matchesDon;
    });

    const donatedCount = filt.filter(r=>r.donated).length;
    const donatedSum   = filt.reduce((s,r)=> s + (parseFloat(r.donation_amt)||0), 0);
    totalsEl.innerHTML = `Rows: <b>${filt.length}</b> ‚Ä¢ Claimed donations: <b>${donatedCount}</b> ‚Ä¢ Sum (claimed): <b>$${donatedSum.toFixed(2)}</b>`;

    rowsEl.innerHTML = filt.map(r=>{
      const when=new Date(r.created_at).toLocaleString();
      const link=r.url?`<a href="${r.url}" target="_blank" rel="noopener">open</a>`:'';
      const don=(r.donation_org||r.donation_amt)?`${r.donation_org||''} ${r.donation_amt?('$'+r.donation_amt):''}${r.donation_evidence_url?(' ‚Ä¢ <a href="'+r.donation_evidence_url+'" target="_blank" rel="noopener">receipt</a>'):''}`:'';
      const dBadge=r.donated ? (r.donation_status==='verified'?'<span class="badge ok">verified</span>': r.donation_status==='rejected'?'<span class="badge no">rejected</span>':'<span class="badge warn">unverified</span>') : '<span class="mini">n/a</span>';
      const aBadge=r.approved?'<span class="badge ok">Yes</span>':'<span class="badge no">No</span>';
      return `<tr>
        <td>${when}</td>
        <td>${r.action||''}</td>
        <td>${link}</td>
        <td>${don||''}</td>
        <td>${dBadge}</td>
        <td>${aBadge}</td>
        <td>${(r.name||'')}${r.email?(' ‚Ä¢ '+r.email):''}</td>
        <td>
          ${r.donated?`
            <a href="#" class="btn act" data-id="${r.id}" data-act="verify">Verify</a>
            <a href="#" class="btn act" data-id="${r.id}" data-act="reject">Reject</a>`:''}
          <a href="#" class="btn act" data-id="${r.id}" data-act="${r.approved?'unapprove':'approve'}">${r.approved?'Unapprove':'Approve'}</a>
        </td>
      </tr>`;
    }).join('') || `<tr><td colspan="8" class="mini">No rows.</td></tr>`;
  }

  rowsEl.addEventListener('click', async (e)=>{
    const a=e.target.closest('a.act'); if(!a){e.preventDefault();return;}
    e.preventDefault();
    const id=a.getAttribute('data-id'), act=a.getAttribute('data-act');
    if (act==='verify')   await db.from('public_submissions').update({ donation_status:'verified', approved:true }).eq('id', id);
    if (act==='reject')   await db.from('public_submissions').update({ donation_status:'rejected', approved:false }).eq('id', id);
    if (act==='approve')  await db.from('public_submissions').update({ approved:true }).eq('id', id);
    if (act==='unapprove')await db.from('public_submissions').update({ approved:false }).eq('id', id);
    load();
  });

  fTxt.addEventListener('input', load);
  fApp.addEventListener('change', load);
  fDon.addEventListener('change', load);
  load();
})();
</script>
</body>
</html>
